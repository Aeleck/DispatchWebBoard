!function(e){"use strict";function t(e){if("string"!=typeof e)throw new TypeError("URI must be a string");this.WSSUri=e,this.socket=null,this.clientId="",this.reconnected=!1,this.isAuthenticated=!1,this.openRequests={},this.listeners={}}function n(e){return function(){return this[e].apply(this,arguments)}}function o(e=48){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],o=0;for(o=0;o<e;o+=1)n.push(t.charAt(Math.floor(Math.random()*t.length)));return n.join("")}let i=t.prototype;i.createSocket=function(){return new Promise((e,t)=>{let n=window.setTimeout(()=>{window.console.error(`RatSocket - Connection failed.`);t({context:this,data:{errors:[{code:408,detail:"Server produced no response.",status:"Request Timeout",title:"Request Timeout"}],meta:{}}})},6e4);this.once("welcome",(t,o)=>{window.clearTimeout(n);this.clientId=o.meta.id;window.console.debug(`RatSocket - Connection successful! Given clientId: ${this.clientId}`);e({context:t,data:o})}).once("ratsocket:error",(e,o)=>{window.clearTimeout(n);t({context:e,data:{errors:[{code:500,detail:o,status:"Error.",title:"Error."}],meta:{}}})});this.socket=new WebSocket(this.WSSUri);this.socket.onopen=(e=>{this._onSocketOpen(e)});this.socket.onclose=(e=>{this._onSocketClose(e)});this.socket.onerror=(e=>{this._onSocketError(e)});this.socket.onmessage=(e=>{this._onSocketMessage(e)});window.console.debug("RatSocket - Socket opened, awaiting response...")})},i.connect=n("createSocket"),i._onSocketOpen=function(e){if(this.reconnected)return window.console.debug("RatSocket - Socket reconnected!"),this._emitEvent("ratsocket:reconnect",e),void(this.reconnected=!1);this._emitEvent("ratsocket:connect",e),window.console.debug("RatSocket - Socket Connected!")},i._onSocketClose=function(e){!1===e.wasClean&&(window.console.debug("RatSocket - Disconnected from API! Attempting to reconnect..."),this._emitEvent("ratsocket:disconnect",e),this.initComp=!1,setTimeout(this.CreateSocket,1e4),this.reconnected=!0)},i._onSocketError=function(e){window.console.error("RatSocket - Socket Error: ",e),this._emitEvent("ratsocket:error",e)},i._onSocketMessage=function(e){let t=JSON.parse(e.data);if(window.console.debug("RatSocket - New message: ",t),"string"==typeof t.meta.dwbRequestUID&&this.openRequests.hasOwnProperty(t.meta.dwbRequestUID))return window.console.debug(`RatSocket- Detected request response. closing request: ${t.meta.dwbRequestUID}`),this.openRequests[t.meta.dwbRequestUID](t),void delete this.openRequests[t.meta.dwbRequestUID];this._emitEvent(t.meta.action,t)},i.send=function(e){if(1!==this.socket.readyState)return this.socket.readyState>1&&this.createSocket(),setTimeout(()=>{this.send(e)}),this;if(e.applicationId=this.clientId,!Util.isValidProperty(e,"action","string"))throw TypeError("Action property must be defined.");return Util.isValidProperty(e,"data","object")||(e.data={}),Util.isValidProperty(e,"meta","object")||(e.meta={}),window.console.debug("RatSocket - Sending message: ",e),this.socket.send(JSON.stringify(e)),this},i.sendRequest=function(e){Util.isValidProperty(e,"meta","object")||(e.meta={});let t=o(48);return e.meta.dwbRequestUID=t,window.console.debug(`RatSocket - Generating request with id: ${t}`),new Promise((n,o)=>{this.send(e);let i=window.setTimeout(()=>{o({context:this,data:{errors:[{code:408,detail:"Server produced no response.",status:"Request Timeout",title:"Request Timeout"}],meta:e.meta}})},6e4);this.openRequests[t]=(e=>{window.clearTimeout(i);e.errors&&o({context:this,data:e});n({context:this,data:e})})})},i.request=n("sendRequest"),i.authenticate=function(e){return this.sendRequest({action:"authorization",applicationId:this.clientId,bearer:e,data:{},meta:{}}).then(e=>{e.data.id&&(this.isAuthenticated=!0)})},i.subscribe=function(e){return this.sendRequest({action:"stream:subscribe",applicationId:e,data:{},meta:{}})},i.addListener=function(e,t){if("string"!=typeof e||null===typeof t)throw new TypeError("Invalid argument(s)");return this.listeners.hasOwnProperty(e)||(this.listeners[e]=[]),this.listeners[e].push("object"==typeof t?t:{func:t,once:!1}),this},i.on=n("addListener"),i.addListenerOnce=function(e,t){return this.addListener(e,{func:t,once:!0})},i.once=n("addListenerOnce"),i.removeListener=function(e,t){if("string"!=typeof e||"function"!=typeof t)throw new TypeError("Invalid argument(s)");if(!this.listeners.hasOwnProperty(e))return;let n=this.listeners[e].findIndex(e=>e.func===t);if(!(n<0))return this.listeners[e].splice(n,1),this},i.off=n("removeListener"),i._emitEvent=function(e,t){if("string"!=typeof e)throw new TypeError("Event must be string");if(!this.listeners.hasOwnProperty(e))return void window.console.debug(`RatSocket - Event: "${e}" has no listener. Returning...`);let n=[this];Array.isArray(t)?n.concat(t):n.push(t);let o=this.listeners[e];window.console.debug(`RatSocket - Executing listener functions for: ${e} with args:`,t);for(let t=0;t<o.length;t++){let i=o[t],s=i.func.apply(this,n);!0!==i.once&&!0!==s||this.removeListener(e,i.func)}return this},e.RatSocket=t}(this||{});