function getTimeSpan(e,t){return Math.round(e/1e3)-Math.round(t/1e3)}var fr=void 0!==fr?fr:{},debug=void 0===debug||debug;fr.client={cId:debug?"95a43559-69c3-40a6-86bb-f97d5d028e5e":"6ae5920a-8764-4338-9877-aa4d9f851e0e",currentToken:null,CookieBase:"fr_db_",CachedRescues:{},CachedRats:{},SelectedRescue:null,init:function(){debug&&console.log("fr.client.init - fr.Client loaded. DEBUG MODE ACTIVE."),fr.client.RequestRescueList(),fr.client.UpdateClock(),window.onpopstate=fr.client.HandlePopState},GetCookie:function(e){try{var t=document.cookie;e=fr.client.CookieBase+e;var a=t.indexOf(e+"=")+1;if(0===a)return null;a+=e.length;var d=t.indexOf(";",a);return d==-1&&(d=t.length),decodeURIComponent(t.substring(a,d))}catch(e){}return null},SetCookie:function(e,t,a){var d=fr.client.CookieBase+e+"="+escape(t)+(0!==a?"; path=/; expires="+new Date((new Date).getTime()+a).toUTCString()+";":"; path=/;");document.cookie=d},CanSetCookies:function(){SetCookie("CookieTest","true",0);var e=null!==GetCookie("CookieTest");return DelCookie("CookieTest"),e},DelCookie:function(e){document.cookie=fr.client.CookieBase+e+"=0; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},HandleTPA:function(e){switch(debug&&console.log("fr.client.HandleTPA - New TPA"),debug&&console.log(e),e.meta.action){case"rescues:read":for(var t in e.data)fr.client.AddRescue(e.data[t]);fr.client.ParseQueryString();break;case"rescue:created":fr.client.AddRescue(e.data);break;case"rescue:updated":fr.client.UpdateRescue(e.data);break;case"rats:read":fr.client.UpdateRats(e);break;case"welcome":case"stream:subscribe":break;default:console.log("Unhandled TPA: "+e)}},RequestRescueList:function(){fr.ws.send("rescues:read",{open:"true"});var e=$('<table id="rescueTable" class="table table-striped table-bordered"></table>'),t=$('<thead><th>Case #</th><th>CMDR Name</th><th>System</th><th>Rats</th><th width="45px"></th></thead>');e.append(t),$("#columnBoard").empty().append(e)},FetchRatInfo:function(e){return fr.client.CachedRats[e]?(debug&&console.log("fr.client.FetchRatInfo - Cached Rat Requested: "),debug&&console.log(fr.client.CachedRats[e]),fr.client.CachedRats[e]):(debug&&console.log("fr.client.FetchRatInfo - Gathering RatInfo: "+e),fr.ws.send("rats:read",{id:e},{searchId:e}),null)},UpdateRats:function(e){var t=$(".rat-"+e.meta.searchId);e.data.length>0?(fr.client.CachedRats[e.data[0].id]||(debug&&console.log("fr.client.UpdateRats - Caching RatInfo:  "+e.data[0].id+" : "+e.data[0].CMDRname),fr.client.CachedRats[e.data[0].id]=e.data[0]),t.text(e.data[0].CMDRname)):t.html("<i>Not found</i>")},ParseQueryString:function(){var e=$.getUrlParam("ar");e&&fr.client.CachedRescues[e]&&fr.client.SetSelectedRescue(e,!0)},HandlePopState:function(e){fr.client.SetSelectedRescue(e.state.ar,!0)},AddRescue:function(e){if(e){var t=$("#rescueTable"),a=e;if($("#rescue-"+a.id).length>0)return void fr.client.UpdateRescue(e);var d=a.rats,i=[];for(var l in d){var n=fr.client.FetchRatInfo(d[l]);i.push('<span class="rat-'+d[l]+'">'+(n?n.CMDRname:"<i>Loading</i>")+"</span>")}var s=$('<tr id="rescue-'+a.id+'"><td>'+(a.data&&a.data.boardIndex?a.data.boardIndex:"X")+'</td><td title="'+(a.data&&a.data.IRCNick?"Nick: "+a.data.IRCNick:"")+'">'+(a.client?a.client:"")+' <span class="rescue-platform">'+(a.platform?a.platform.toUpperCase():"")+"</span></td><td>"+(a.system?a.system:"unknown")+"</td><td>"+i.join(", ")+"</td><td onClick=\"javascript:fr.client.SetSelectedRescue('"+a.id+'\',false)"><button id="detailBtn-'+a.id+'" type="button" class="btn btn-default btn-xs btn-fr-detail"><span class="glyphicon glyphicon-info-sign"></span></button></td></tr>');a.epic?s.addClass("rescue-epic"):s.removeClass("rescue-epic"),a.codeRed?s.addClass("rescue-codered"):s.removeClass("rescue-codered"),a.active?s.removeClass("rescue-inactive"):s.addClass("rescue-inactive");var c=a.quotes.join("\n");s.attr("title",c),debug&&console.log("fr.client.AddRescue: Rescue Added to board."),fr.client.CachedRescues[a.id]=a,t.append(s)}},UpdateRescue:function(e){if(e){var t=$("#rescue-"+e.id),a=e,d=a.rats,i=[];for(var l in d){var n=fr.client.FetchRatInfo(d[l]);i.push('<span class="rat-'+d[l]+'">'+(n?n.CMDRname:"<i>Loading</i>")+"</span>")}t.html("<td>"+(a.data&&a.data.boardIndex?a.data.boardIndex:"X")+'</td><td title="'+(a.data&&a.data.IRCNick?"Nick: "+a.data.IRCNick:"")+'">'+(a.client?a.client:"")+' <span class="rescue-platform">'+(a.platform?a.platform.toUpperCase():"")+"</span></td><td>"+(a.system?a.system:"unknown")+"</td><td>"+i.join(", ")+"</td><td onClick=\"javascript:fr.client.SetSelectedRescue('"+a.id+'\',false)"><button id="detailBtn-'+a.id+'" type="button" class="btn btn-default btn-xs btn-fr-detail"><span class="glyphicon glyphicon-info-sign"></span></button></td></td>'),a.epic?t.addClass("rescue-epic"):t.removeClass("rescue-epic"),a.codeRed?t.addClass("rescue-codered"):t.removeClass("rescue-codered"),a.active?t.removeClass("rescue-inactive"):t.addClass("rescue-inactive");var s=a.quotes.join("\n");if(t.attr("title",s),t.animate({opacity:.3},500).animate({opacity:1},500),!a.open)return setTimeout(function(){t.hide("slow").remove()},5e3),debug&&console.log("fr.client.UpdateRescue - Rescue Removed: "+a.id+" : "+a.client),void delete fr.client.CachedRescues[a.id];debug&&console.log("fr.client.UpdateRescue - Rescue Updated: "+a.id+" : "+a.client),fr.client.CachedRescues[a.id]=a,e.id===fr.client.SelectedRescue.id&&(debug&&console.log("fr.client.UpdateRescue - Rescue DetailView Updating: "+a.id+" : "+a.client),fr.client.SelectedRescue=a,fr.client.UpdateRescueDetail())}},UpdateClock:function(){var e=new Date,t=e.getUTCFullYear()+1286+"-"+(e.getUTCMonth()+1<10?"0":"")+(e.getUTCMonth()+1)+"-"+(e.getUTCDate()<10?"0":"")+e.getUTCDate()+" "+(e.getUTCHours()<10?"0":"")+e.getUTCHours()+":"+(e.getUTCMinutes()<10?"0":"")+e.getUTCMinutes()+":"+(e.getUTCSeconds()<10?"0":"")+e.getUTCSeconds();$(".ed-clock").text(t),setTimeout(fr.client.UpdateClock,500)},RescueClockTimeoutID:null,UpdateRescueClock:function(){if(null!==fr.client.SelectedRescue){var e=getTimeSpan(Date.now(),Date.parse(fr.client.SelectedRescue.createdAt)),t=e%60;e-=t;var a=Math.floor(e/60)%60;e-=60*a;var d=Math.floor(e/3600),i=(d<10?"0":"")+d+":"+(a<10?"0":"")+a+":"+(t<10?"0":"")+t;$(".rdetail-timer").text(i)}},SetSelectedRescue:function(e,t){if(null===e||fr.client.SelectedRescue&&e===fr.client.SelectedRescue.id){if(fr.client.SelectedRescue=null,null!==fr.client.RescueClockTimeoutID&&(window.clearInterval(fr.client.RescueClockTimeoutID),fr.client.RescueClockTimeoutID=null),history.pushState&&!t){var a=window.location.protocol+"//"+window.location.host+window.location.pathname;window.history.pushState({ar:null},"",a)}return void fr.client.UpdateRescueDetail()}if(null===fr.client.CachedRescues[e])return void console.log("SetSelectedRescue - invalid key: "+e);if(debug&&console.log("SetSelectedRescue - New SelectedRescue: "+fr.client.CachedRescues[e].id),null===fr.client.RescueClockTimeoutID&&(fr.client.RescueClockTimeoutID=window.setInterval(fr.client.UpdateRescueClock,500)),fr.client.SelectedRescue=fr.client.CachedRescues[e],history.pushState&&!t){var a=window.location.protocol+"//"+window.location.host+window.location.pathname+"?ar="+encodeURIComponent(e);window.history.pushState({ar:e},"",a)}fr.client.UpdateRescueDetail()},UpdateRescueDetail:function(){if($(".btn-fr-detail.active").removeClass("active").removeClass("btn-info").addClass("btn-default"),!fr.client.SelectedRescue)return void $("#columnDetail").addClass("fr-hidden");var e=fr.client.SelectedRescue,t='<div class="rdetail-header"><div class="rdetail-title">'+(e.data&&e.data.boardIndex?"#"+e.data.boardIndex+" - ":"")+(e.title?e.title:e.client)+(e.codeRed?' <span class="label label-danger">Code Red</span>':"")+(e.active?"":' <span class="label label-warning">Inactive</span>')+'</div><div class="rdetail-timer">00:00:00</div></div><table class="rdetail-body table table-rescue"><thead><td width="90px"></td><td></td></thead><tbody>'+(e.data&&e.data.IRCNick?'<tr class="rdetail-info"><td class="rdetail-info-title">IRC Nick</td><td class="rdetail-info-value">'+e.data.IRCNick+"</td></tr>":"")+(e.system?'<tr class="rdetail-info"><td class="rdetail-info-title">System</td><td class="rdetail-info-value">'+e.system+"</td></tr>":"")+(e.platform?'<tr class="rdetail-info"><td class="rdetail-info-title">Platform</td><td class="rdetail-info-value">'+e.platform.toUpperCase()+"</td></tr>":"")+(e.data&&e.data.langID?'<tr class="rdetail-info"><td class="rdetail-info-title">Language</td><td class="rdetail-info-value">'+e.data.langID.toUpperCase()+"</td></tr>":"")+'<tr class="rdetail-info"><td class="rdetail-info-title">UUID</td><td class="rdetail-info-value">'+e.id+'</td></tr><tr class="rdetail-info-seperator"><td class="tbl-border-none"></td><td></td></tr>',a=[];for(var d in e.rats){var i=fr.client.FetchRatInfo(e.rats[d]);a.push('<span class="rat-'+e.rats[d]+'">'+(null!==i?i.CMDRname:"<i>Loading</i>")+"</span>")}for(var l in e.unidentifiedRats)a.push('<span class="rat-unidentified">'+e.unidentifiedRats[l]+'</span> <span class="label label-warning">unidentified</span>');if(t+='<tr class="rdetail-info"><td class="rdetail-info-title">Rats</td><td class="rdetail-info-value tbl-border-box">'+(a.length>0?a[0]:"<i>Unassigned</i>")+"</td></tr>",a.length>1)for(var n=1;n<a.length;n++)t+='<tr class="rdetail-info"><td class="rdetail-info-empty"></td><td class="rdetail-info-value tbl-border-box">'+a[n]+"</td></tr>";if(t+='<tr class="rdetail-info-seperator"><td class="tbl-border-none"></td><td></td></tr>',t+='<tr class="rdetail-info"><td class="rdetail-info-title">Quotes</td><td class="rdetail-info-value tbl-border-box">'+(e.quotes.length>0?e.quotes[0]:"<i>None</i>")+"</td></tr>",e.quotes.length>1)for(var n=1;n<e.quotes.length;n++)t+='<tr class="rdetail-info"><td class="rdetail-info-empty"></td><td class="rdetail-info-value tbl-border-box">'+e.quotes[n]+"</td></tr>";debug&&console.log("fr.client.UpdateRescueDetail - Rescue DetailView Updated: "+e.id+" : "+e.client),$("#columnDetail").removeClass("fr-hidden"),$("#rescueDetail").animate({opacity:.2},100).html(t).animate({opacity:1},500),$("#detailBtn-"+e.id).addClass("active").addClass("btn-info").removeClass("btn-default")}};