fr.client=fr.config&&fr.ws&&fr.sysapi?{currentToken:null,clipboard:null,CachedRescues:{},SelectedRescue:null,initComp:!1,init:function(){fr.client.initComp?debug&&window.console.log("fr.client.init - init completed already!"):(debug&&window.console.log("fr.client.init - fr.Client loaded. DEBUG MODE ACTIVE."),window.onpopstate=fr.client.HandlePopState,fr.ws.HandleTPA=fr.client.HandleTPA,fr.ws.send("rescues:read",{open:"true"},{}),fr.client.UpdateClocks(),$("#navbar-brand-title").text(fr.config.WebPageTitle),$("body").on("click","button.btn.btn-detail",function(){fr.client.SetSelectedRescue($(this).data("rescue-sid"))}).on("click","button.btn.btn-nav-toggle",function(){$($(this).data("target")).toggleClass("expand"),$(this).toggleClass("active")}),Clipboard.isSupported()&&(fr.client.clipboard=new Clipboard(".btn-clipboard"),$("body").addClass("clipboard-enable")),fr.client.initComp=!0)},HandleTPA:function(e){switch(debug&&window.console.log("fr.client.HandleTPA - New TPA: ",e),e.meta.action){case"rescues:read":fr.client.AddExistingRescues(e.data);break;case"rescue:created":fr.client.AddRescue(e.data);break;case"rescue:updated":fr.client.UpdateRescue(e.data);break;case"rats:read":fr.client.UpdateRats(e);break;case"welcome":case"stream:subscribe":case"authorization":break;default:window.console.log("fr.client.Handle.TPA - Unhandled TPA: ",e)}},AddExistingRescues:function(e){for(let t in e)e.hasOwnProperty(t)&&fr.client.AddRescue(e[t]);fr.client.ParseQueryString(),$("body").removeClass("loading")},FetchRatInfo:function(e){if(sessionStorage.getItem("rat."+e)){let t=JSON.parse(sessionStorage.getItem("rat."+e));return debug&&window.console.log("fr.client.FetchRatInfo - Cached Rat Requested: ",t),t}return debug&&window.console.log("fr.client.FetchRatInfo - Gathering RatInfo: "+e),fr.ws.send("rats:read",{id:e},{searchId:e}),null},UpdateRats:function(e){let t=$('.rat[data-rat-name="'+e.meta.searchId+'"]');if(e.data.length>0){let a=e.data[0];sessionStorage.getItem("rat."+a.id)||(debug&&window.console.log("fr.client.UpdateRats - Caching RatInfo: ",a),sessionStorage.setItem("rat."+a.id,JSON.stringify(a))),t.text(a.CMDRname)}else t.html("<i>Not found</i>")},ParseQueryString:function(){let e=$.getUrlParam("a");e&&fr.client.CachedRescues[e]?fr.client.SetSelectedRescue(e,!0):history.replaceState&&window.history.replaceState({a:null},document.title,window.location.pathname)},HandlePopState:function(e){fr.client.SetSelectedRescue(e.state.a,!0)},AddRescue:function(e){if(e){let t=e,a=t.id.split("-")[0];$('tr.rescue[data-rescue-sid="'+a+'"]').length>0?fr.client.UpdateRescue(e):(debug&&window.console.log("fr.client.AddRescue: Rescue Added to board."),fr.client.CachedRescues[a]=t,$("#rescueTable").append(fr.client.GetRescueTableRow(e)))}},UpdateRescue:function(e){if(e){let t=e,a=t.id.split("-")[0],s=$('tr.rescue[data-rescue-sid="'+a+'"]');if(s){if(!t.open)return setTimeout(function(){s.hide("slow").remove()},5e3),debug&&window.console.log("fr.client.UpdateRescue - Rescue Removed: "+t.id+" : "+t.client),t.id&&fr.client.SelectedRescue&&t.id===fr.client.SelectedRescue.id&&fr.client.SetSelectedRescue(null),void delete fr.client.CachedRescues[a];debug&&window.console.log("fr.client.UpdateRescue - Rescue Updated: "+t.id+" : "+t.client),s.replaceWith(fr.client.GetRescueTableRow(e)),$('tr.rescue[data-rescue-sid="'+a+'"]').animate({opacity:.2},100).animate({opacity:1},500),fr.client.CachedRescues[a]=t,t.id&&fr.client.SelectedRescue&&t.id===fr.client.SelectedRescue.id&&(debug&&window.console.log("fr.client.UpdateRescue - Rescue DetailView Updating: "+t.id+" : "+t.client),fr.client.SelectedRescue=t,fr.client.UpdateRescueDetail())}else debug&&window.console.log("fr.client.UpdateRescue: Attempted to update a non-existant rescue: ",t)}},GetRescueTableRow:function(e){if(e){let t=e.id.split("-")[0],a=e.rats,s=[];for(let t in a)if(a.hasOwnProperty(t)){let i=fr.client.FetchRatInfo(a[t]);s.push('<span class="rat rat-name" data-rat-name="'+e.rats[t]+'">'+(i?i.CMDRname:"<i>Loading</i>")+"</span>")}for(let t in e.unidentifiedRats)e.unidentifiedRats.hasOwnProperty(t)&&s.push('<span class="rat-unidentified"><i>'+e.unidentifiedRats[t]+"</i></span>");let i=$('<tr class="rescue" data-rescue-sid="'+t+'"><td class="rescue-row-index">'+(e.data&&(void 0!==e.data.boardIndex||null!==e.data.boardIndex)?e.data.boardIndex:"?")+'</td><td class="rescue-row-client" title="'+(e.data&&e.data.IRCNick?"Nick: "+e.data.IRCNick:"")+'">'+(e.client?e.client:"?")+'</td><td class="rescue-row-language"'+(e.data&&e.data.langID?fr.const&&fr.const.language[e.data.langID]?'title="'+fr.const.language[e.data.langID].long+'">'+fr.const.language[e.data.langID].short:">"+e.data.langID:">?")+'</td><td class="rescue-row-platform"'+(e.platform?fr.const&&fr.const.platform[e.platform]?'title="'+fr.const.platform[e.platform].long+'">'+fr.const.platform[e.platform].short:">"+e.platform:">?")+'</td><td class="rescue-row-system'+(e.system?' btn-clipboard" data-clipboard-text="'+e.system+'">'+e.system+'<i class="fa fa-clipboard" title="Click to Copy!"></i>':'">')+'</td><td class="rescue-row-rats">'+s.join(", ")+'</td><td class="rescue-row-detail"><button type="button" class="btn btn-detail" data-rescue-sid="'+t+'"><span class="fa fa-info" aria-hidden="true"></span></button></td></tr>');e.epic?i.addClass("rescue-epic"):i.removeClass("rescue-epic"),e.codeRed?i.addClass("rescue-codered"):i.removeClass("rescue-codered"),e.active?i.removeClass("rescue-inactive"):i.addClass("rescue-inactive");let n=e.quotes.join("\n");return i.attr("title",n),i}},UpdateClocks:function(){let e=new Date;$(".ed-clock").text(e.getUTCFullYear()+1286+" "+fr.const.monthString[e.getUTCMonth()]+" "+(e.getUTCDate()<10?"0":"")+e.getUTCDate()+" "+(e.getUTCHours()<10?"0":"")+e.getUTCHours()+":"+(e.getUTCMinutes()<10?"0":"")+e.getUTCMinutes()+":"+(e.getUTCSeconds()<10?"0":"")+e.getUTCSeconds()),null!==fr.client.SelectedRescue&&($(".rdetail-timer").text(getTimeSpanString(e,Date.parse(fr.client.SelectedRescue.createdAt))),$(".rdetail-timer").prop("title","Last Updated: "+getTimeSpanString(e,Date.parse(fr.client.SelectedRescue.updatedAt)))),setTimeout(fr.client.UpdateClocks,1e3-e.getMilliseconds())},SetSelectedRescue:function(e,t){if(null===e||fr.client.SelectedRescue&&e.toString()===fr.client.SelectedRescue.id.split("-")[0])return fr.client.SelectedRescue=null,history.pushState&&!t&&window.history.pushState({a:null},document.title,window.location.pathname),void fr.client.UpdateRescueDetail();fr.client.CachedRescues[e]?(debug&&window.console.log("fr.client.SetSelectedRescue - New SelectedRescue: "+fr.client.CachedRescues[e].id),fr.client.SelectedRescue=fr.client.CachedRescues[e],history.pushState&&!t&&window.history.pushState({a:e},document.title,window.location.pathname+"?a="+encodeURIComponent(e)),fr.client.UpdateRescueDetail()):window.console.log("fr.client.SetSelectedRescue - invalid key: "+e)},UpdateRescueDetail:function(){if($("button.btn-detail.active").removeClass("active"),fr.client.SelectedRescue){let e=fr.client.SelectedRescue,t='<div class="rdetail-header"><div class="rdetail-title">'+(e.data&&void 0!==e.data.boardIndex&&null!==e.data.boardIndex?"#"+e.data.boardIndex+" - ":"")+(e.title?e.title:e.client)+(e.codeRed?' <span class="badge badge-red">Code Red</span>':"")+(e.active?"":' <span class="badge badge-yellow">Inactive</span>')+'</div><div class="rdetail-timer">00:00:00</div></div><table class="rdetail-body table table-rescue"><thead><td width="90px"></td><td></td></thead><tbody>'+(e.data&&e.data.IRCNick?'<tr class="rdetail-info"><td class="rdetail-info-title">IRC Nick</td><td class="rdetail-info-value">'+e.data.IRCNick+"</td></tr>":"")+(e.system?'<tr class="rdetail-info"><td class="rdetail-info-title">System</td><td class="rdetail-info-value">'+e.system+'<span class="float-right system-apidata" data-system-name="'+e.system.toUpperCase()+'"><i>Retrieving info...</i</span></td></tr>':"")+(e.platform?'<tr class="rdetail-info"><td class="rdetail-info-title">Platform</td><td class="rdetail-info-value">'+(fr.const&&fr.const.platform[e.platform]?fr.const.platform[e.platform].long:e.platform)+"</td></tr>":"")+(e.data&&e.data.langID?'<tr class="rdetail-info"><td class="rdetail-info-title">Language</td><td class="rdetail-info-value">'+(fr.const&&fr.const.language[e.data.langID]?fr.const.language[e.data.langID].long+" ("+fr.const.language[e.data.langID].short+")":e.data.langID)+"</td></tr>":"")+'<tr class="rdetail-info"><td class="rdetail-info-title">UUID</td><td class="rdetail-info-value">'+e.id+'</td></tr><tr class="rdetail-info-seperator"><td class="tbl-border-none"></td><td></td></tr>',a=[];for(let t in e.rats)if(e.rats.hasOwnProperty(t)){let s=fr.client.FetchRatInfo(e.rats[t]);a.push('<span class="rat rat-name" data-rat-name="'+e.rats[t]+'">'+(null!==s?s.CMDRname:"<i>Loading</i>")+"</span>")}for(let t in e.unidentifiedRats)e.unidentifiedRats.hasOwnProperty(t)&&a.push('<span class="rat-unidentified">'+e.unidentifiedRats[t]+'</span> <span class="badge badge-yellow">unidentified</span>');if(a.length>0){if(t+='<tr class="rdetail-info"><td class="rdetail-info-title">Rats</td><td class="rdetail-info-value tbl-border-box">'+a[0]+"</td></tr>",a.length>1)for(let e=1;e<a.length;e++)t+='<tr class="rdetail-info"><td class="rdetail-info-empty"></td><td class="rdetail-info-value tbl-border-box">'+a[e]+"</td></tr>";t+='<tr class="rdetail-info-seperator"><td class="tbl-border-none"></td><td></td></tr>'}if(e.quotes.length>0&&(t+='<tr class="rdetail-info"><td class="rdetail-info-title">Quotes</td><td class="rdetail-info-value tbl-border-box">'+(e.quotes.length>0?e.quotes[0]:"<i>None</i>")+"</td></tr>",e.quotes.length>1))for(let a=1;a<e.quotes.length;a++)t+='<tr class="rdetail-info"><td class="rdetail-info-empty"></td><td class="rdetail-info-value tbl-border-box">'+e.quotes[a]+"</td></tr>";t+="</tbody></table>",debug&&window.console.log("fr.client.UpdateRescueDetail - Rescue DetailView Updated: "+e.id+" : "+e.client),$("#rescueDetailContent").animate({opacity:.2},100).html(t).animate({opacity:1},500),$('button.btn.btn-detail[data-rescue-sid="'+e.id.split("-")[0]+'"]').addClass("active"),$("body").addClass("rdetail-active"),e.system&&(debug&&window.console.log("fr.client.UpdateRescueDetail - Checking sysapi for additional system info."),fr.sysapi.GetSysInfo(e.system,function(e){debug&&window.console.log("fr.client.UpdateRescueDetail - Additional info found! Adding system-related warnings and eddb link.");let t=e,a=t.attributes.name.toUpperCase(),s="";if(t.attributes.needs_permit&&1===t.attributes.needs_permit&&(s+='<span class="badge badge-yellow" title="This system requires a permit!">PERMIT</span> '),t.attributes.is_populated&&1===t.attributes.is_populated&&(s+=' <span class="badge badge-yellow" title="This system is populated, check for stations!">POPULATED</span> '),t.bodies&&t.bodies.length>0){let e=t.bodies.find(function(e){return e.attributes.is_main_star});e&&fr.const.scoopables.includes(e.attributes.spectral_class)?s+=' <span class="badge badge-yellow" title="This system\'s main star is scoopable!">SCOOPABLE</span> ':t.bodies.length>1&&t.bodies.filter(function(e){return fr.const.scoopables.includes(e.attributes.spectral_class)}).length>0&&(s+=' <span class="badge badge-yellow" title="This system contains a scoopable star!">SCOOPABLE [SECONDARY]</span> ')}t.id&&(s+='<a target="_blank" href="https://www.eddb.io/system/'+t.id+'"><span class="badge badge-green" title="View on EDDB.io" >EDDB</span></a>'),$('span[data-system-name="'+a+'"]').animate({opacity:.2},100).html(s).animate({opacity:1},500)},function(){$('span[data-system-name="'+e.system.toUpperCase()+'"]').animate({opacity:.2},100).html('<a target="_blank" href="https://www.eddb.io/"><span class="badge badge-red" title="Go to EDDB.io" >NOT IN EDDB</span></a>').animate({opacity:1},500)}))}else $("body").removeClass("rdetail-active")}}:null;