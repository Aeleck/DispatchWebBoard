function getTimeSpan(e,t){return Math.round(e/1e3)-Math.round(t/1e3)}var fr=void 0!==fr?fr:{},debug=void 0!==debug&&debug;fr.client=fr.config&&fr.ws?{currentToken:null,CachedRescues:{},CachedRats:{},SelectedRescue:null,initComp:!1,init:function(){fr.client.initComp?debug&&console.log("fr.client.init - init completed already!"):(debug&&console.log("fr.client.init - fr.Client loaded. DEBUG MODE ACTIVE."),window.onpopstate=fr.client.HandlePopState,fr.ws.HandleTPA=fr.client.HandleTPA,fr.ws.send("rescues:read",{open:"true"},{}),fr.client.UpdateClocks(),$("#navbar-brand-title").text(fr.config.WebPageTitle),$("body").on("click","button.btn.btn-detail",function(e){fr.client.SetSelectedRescue($(this).data("rescue-id"))}).on("click","button.btn.btn-nav-toggle",function(e){$($(this).data("target")).toggleClass("expand"),$(this).toggleClass("active")}),fr.client.initComp=!0)},HandleTPA:function(e){switch(debug&&console.log("fr.client.HandleTPA - New TPA"),debug&&console.log(e),e.meta.action){case"rescues:read":for(var t in e.data)fr.client.AddRescue(e.data[t]);fr.client.ParseQueryString(),$("body").removeClass("loading");break;case"rescue:created":fr.client.AddRescue(e.data);break;case"rescue:updated":fr.client.UpdateRescue(e.data);break;case"rats:read":fr.client.UpdateRats(e);break;case"welcome":case"stream:subscribe":case"authorization":break;default:console.log("Unhandled TPA"),console.log(e)}},FetchRatInfo:function(e){return fr.client.CachedRats[e]?(debug&&console.log("fr.client.FetchRatInfo - Cached Rat Requested: "),debug&&console.log(fr.client.CachedRats[e]),fr.client.CachedRats[e]):(debug&&console.log("fr.client.FetchRatInfo - Gathering RatInfo: "+e),fr.ws.send("rats:read",{id:e},{searchId:e}),null)},UpdateRats:function(e){var t=$(".rat-"+e.meta.searchId);e.data.length>0?(fr.client.CachedRats[e.data[0].id]||(debug&&console.log("fr.client.UpdateRats - Caching RatInfo:  "+e.data[0].id+" : "+e.data[0].CMDRname),fr.client.CachedRats[e.data[0].id]=e.data[0]),t.text(e.data[0].CMDRname)):t.html("<i>Not found</i>")},ParseQueryString:function(){var e=$.getUrlParam("a");e&&fr.client.CachedRescues[e]?fr.client.SetSelectedRescue(e,!0):history.replaceState&&window.history.replaceState({a:null},document.title,window.location.pathname)},HandlePopState:function(e){fr.client.SetSelectedRescue(e.state.a,!0)},AddRescue:function(e){if(e){var t=e,a=t.id.split("-")[0];if($("#rescue-"+a).length>0)return void fr.client.UpdateRescue(e);debug&&console.log("fr.client.AddRescue: Rescue Added to board."),fr.client.CachedRescues[a]=t,$("#rescueTable").append(fr.client.GetRescueTableRow(e))}},UpdateRescue:function(e){if(e){var t=e,a=t.id.split("-")[0],d=$("#rescue-"+a);if(!d)return debug&&console.log("fr.client.UpdateRescue: Attempted to update a non-existant rescue."),void(debug&&console.log(t));if(!t.open)return setTimeout(function(){d.hide("slow").remove()},5e3),debug&&console.log("fr.client.UpdateRescue - Rescue Removed: "+t.id+" : "+t.client),t.id&&fr.client.SelectedRescue&&t.id===fr.client.SelectedRescue.id&&fr.client.SetSelectedRescue(null),void delete fr.client.CachedRescues[a];debug&&console.log("fr.client.UpdateRescue - Rescue Updated: "+t.id+" : "+t.client),d.replaceWith(fr.client.GetRescueTableRow(e)),$("#rescue-"+a).animate({opacity:.2},100).animate({opacity:1},500),fr.client.CachedRescues[a]=t,t.id&&fr.client.SelectedRescue&&t.id===fr.client.SelectedRescue.id&&(debug&&console.log("fr.client.UpdateRescue - Rescue DetailView Updating: "+t.id+" : "+t.client),fr.client.SelectedRescue=t,fr.client.UpdateRescueDetail())}},GetRescueTableRow:function(e){if(e){var t=e.id.split("-")[0],a=e.rats,d=[];for(var l in a){var i=fr.client.FetchRatInfo(a[l]);d.push('<span class="rat-'+a[l]+'">'+(i?i.CMDRname:"<i>Loading</i>")+"</span>")}for(var n in e.unidentifiedRats)d.push('<span class="rat-unidentified"><i>'+e.unidentifiedRats[n]+"</i></span>");var s=$('<tr id="rescue-'+e.id.split("-")[0]+'"><td>'+(e.data&&(void 0!==e.data.boardIndex||null!==e.data.boardIndex)?e.data.boardIndex:"?")+'</td><td title="'+(e.data&&e.data.IRCNick?"Nick: "+e.data.IRCNick:"")+'">'+(e.client?e.client:"?")+"</td><td>"+(e.data&&e.data.langID?e.data.langID.toUpperCase().replace("UNKNOWN","N/A"):"?")+"</td><td>"+(e.platform?fr.const?fr.const.platformHumanReadable.short[e.platform]:e.platform:"?")+"</td><td>"+(e.system?e.system:"")+"</td><td>"+d.join(", ")+'</td><td><button id="detailBtn-'+t+'" type="button" class="btn btn-detail" data-rescue-id="'+t+'"><span class="fa fa-info" aria-hidden="true"></span></button></td></tr>');e.epic?s.addClass("rescue-epic"):s.removeClass("rescue-epic"),e.codeRed?s.addClass("rescue-codered"):s.removeClass("rescue-codered"),e.active?s.removeClass("rescue-inactive"):s.addClass("rescue-inactive");var c=e.quotes.join("\n");return s.attr("title",c),s}},UpdateClocks:function(){var e=new Date;$(".ed-clock").text(e.getUTCFullYear()+1286+"-"+(e.getUTCMonth()+1<10?"0":"")+(e.getUTCMonth()+1)+"-"+(e.getUTCDate()<10?"0":"")+e.getUTCDate()+" "+(e.getUTCHours()<10?"0":"")+e.getUTCHours()+":"+(e.getUTCMinutes()<10?"0":"")+e.getUTCMinutes()+":"+(e.getUTCSeconds()<10?"0":"")+e.getUTCSeconds()),null!==fr.client.SelectedRescue&&($(".rdetail-timer").text(getTimeSpanString(e,Date.parse(fr.client.SelectedRescue.createdAt))),$(".rdetail-timer").prop("title","Last Updated: "+getTimeSpanString(e,Date.parse(fr.client.SelectedRescue.updatedAt)))),setTimeout(fr.client.UpdateClocks,1e3-e.getMilliseconds())},SetSelectedRescue:function(e,t){return null===e||fr.client.SelectedRescue&&e==fr.client.SelectedRescue.id.split("-")[0]?(fr.client.SelectedRescue=null,history.pushState&&!t&&window.history.pushState({a:null},document.title,window.location.pathname),void fr.client.UpdateRescueDetail()):fr.client.CachedRescues[e]?(debug&&console.log("SetSelectedRescue - New SelectedRescue: "+fr.client.CachedRescues[e].id),fr.client.SelectedRescue=fr.client.CachedRescues[e],history.pushState&&!t&&window.history.pushState({a:e},document.title,window.location.pathname+"?a="+encodeURIComponent(e)),void fr.client.UpdateRescueDetail()):void console.log("SetSelectedRescue - invalid key: "+e)},UpdateRescueDetail:function(){if($("button.btn-detail.active").removeClass("active"),!fr.client.SelectedRescue)return void $("body").removeClass("rdetail-active");var e=fr.client.SelectedRescue,t='<div class="rdetail-header"><div class="rdetail-title">'+(e.data&&(null!==e.data.boardIndex||null!==resuce.data.boardIndex)?"#"+e.data.boardIndex+" - ":"")+(e.title?e.title:e.client)+(e.codeRed?' <span class="badge badge-red">Code Red</span>':"")+(e.active?"":' <span class="badge badge-yellow">Inactive</span>')+'</div><div class="rdetail-timer">00:00:00</div></div><table class="rdetail-body table table-rescue"><thead><td width="90px"></td><td></td></thead><tbody>'+(e.data&&e.data.IRCNick?'<tr class="rdetail-info"><td class="rdetail-info-title">IRC Nick</td><td class="rdetail-info-value">'+e.data.IRCNick+"</td></tr>":"")+(e.system?'<tr class="rdetail-info"><td class="rdetail-info-title">System</td><td class="rdetail-info-value">'+e.system+"</td></tr>":"")+(e.platform?'<tr class="rdetail-info"><td class="rdetail-info-title">Platform</td><td class="rdetail-info-value">'+(fr.const?fr.const.platformHumanReadable.long[e.platform]:e.platform)+"</td></tr>":"")+(e.data&&e.data.langID?'<tr class="rdetail-info"><td class="rdetail-info-title">Language</td><td class="rdetail-info-value">'+e.data.langID.toUpperCase()+"</td></tr>":"")+'<tr class="rdetail-info"><td class="rdetail-info-title">UUID</td><td class="rdetail-info-value">'+e.id+'</td></tr><tr class="rdetail-info-seperator"><td class="tbl-border-none"></td><td></td></tr>',a=[];for(var d in e.rats){var l=fr.client.FetchRatInfo(e.rats[d]);a.push('<span class="rat-'+e.rats[d]+'">'+(null!==l?l.CMDRname:"<i>Loading</i>")+"</span>")}for(var i in e.unidentifiedRats)a.push('<span class="rat-unidentified">'+e.unidentifiedRats[i]+'</span> <span class="badge badge-yellow">unidentified</span>');if(a.length>0){if(t+='<tr class="rdetail-info"><td class="rdetail-info-title">Rats</td><td class="rdetail-info-value tbl-border-box">'+a[0]+"</td></tr>",a.length>1)for(var n=1;n<a.length;n++)t+='<tr class="rdetail-info"><td class="rdetail-info-empty"></td><td class="rdetail-info-value tbl-border-box">'+a[n]+"</td></tr>";t+='<tr class="rdetail-info-seperator"><td class="tbl-border-none"></td><td></td></tr>'}if(e.quotes.length>0&&(t+='<tr class="rdetail-info"><td class="rdetail-info-title">Quotes</td><td class="rdetail-info-value tbl-border-box">'+(e.quotes.length>0?e.quotes[0]:"<i>None</i>")+"</td></tr>",e.quotes.length>1))for(var n=1;n<e.quotes.length;n++)t+='<tr class="rdetail-info"><td class="rdetail-info-empty"></td><td class="rdetail-info-value tbl-border-box">'+e.quotes[n]+"</td></tr>";t+="</tbody></table>",debug&&console.log("fr.client.UpdateRescueDetail - Rescue DetailView Updated: "+e.id+" : "+e.client),debug&&console.log(e),$("#rescueDetail").animate({opacity:.2},100).html(t).animate({opacity:1},500),$("#detailBtn-"+e.id.split("-")[0]).addClass("active").addClass("btn-info").removeClass("btn-default"),$("body").addClass("rdetail-active")}}:null;