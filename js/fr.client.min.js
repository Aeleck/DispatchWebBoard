function getTimeSpan(e,t){return Math.round(e/1e3)-Math.round(t/1e3)}var fr=void 0!==fr?fr:{},debug=void 0===debug||debug;fr.client={cId:"4eace3e0-6564-4d41-87d4-bae2e2d2f6df",currentToken:null,CookieBase:"fr_db_",Rescues:{},CachedRats:{},SelectedRescue:null,init:function(){fr.client.RequestRescueList(),fr.client.UpdateClock(),fr.client.UpdateRescueClock(),$("#VersionInfo").text("FuelRats Dispatch Board v0.2"+(debug?" - DEBUG MODE":""))},GetCookie:function(e){try{var t=document.cookie;e=fr.client.CookieBase+e;var a=t.indexOf(e+"=")+1;if(0===a)return null;a+=e.length;var d=t.indexOf(";",a);return d==-1&&(d=t.length),decodeURIComponent(t.substring(a,d))}catch(e){}return null},SetCookie:function(e,t,a){var d=fr.client.CookieBase+e+"="+escape(t)+(0!==a?"; path=/; expires="+new Date((new Date).getTime()+a).toUTCString()+";":"; path=/;");document.cookie=d},CanSetCookies:function(){SetCookie("CookieTest","true",0);var e=null!==GetCookie("CookieTest");return DelCookie("CookieTest"),e},DelCookie:function(e){document.cookie=fr.client.CookieBase+e+"=0; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},HandleTPA:function(e){switch(debug&&console.log("HandleTPA - New TPA"),debug&&console.log(e),e.meta.action){case"rescues:read":if(void 0!==e.meta.updateList)for(var t in e.data)fr.client.AddRescue(e.data[t]);else fr.client.GetRescueList(e);break;case"rescue:created":fr.client.AddRescue(e.data);break;case"rescue:updated":fr.client.UpdateRescue(e.data);break;case"rats:read":fr.client.UpdateRats(e);break;case"welcome":case"stream:subscribe":break;default:console.log("Unhandled TPA: "+e)}},RequestRescueList:function(){fr.ws.send("rescues:read",{open:"true"});var e=$('<table id="rescueTable" class="table table-striped table-bordered"></table>'),t=$("<thead><th>Case #</th><th>CMDR Name</th><th>System</th><th>Rats</th></thead>");e.append(t),$("#rescueBoard").empty().append(e)},FetchRatInfo:function(e){return fr.client.CachedRats[e]?(debug&&console.log("FetchRatInfo - Cached Rat Requested: "),debug&&console.log(fr.client.CachedRats[e]),fr.client.CachedRats[e]):(debug&&console.log("FetchRatInfo - Gathering RatInfo: "+e),fr.ws.send("rats:read",{id:e},{searchId:e}),null)},UpdateRats:function(e){var t=$(".rat-"+e.meta.searchId);e.data.length>0?(fr.client.CachedRats[e.data[0].id]||(debug&&console.log("UpdateRats - Caching RatInfo:  "+e.data[0].id+" : "+e.data[0].CMDRname),fr.client.CachedRats[e.data[0].id]=e.data[0]),t.text(e.data[0].CMDRname)):t.html("<i>Not found</i>")},AddRescue:function(e){var t=$("#rescueTable"),a=e;if($("#rescue-"+a.id).length>0)return void fr.client.UpdateRescue(e);var d=a.rats,s=[];for(var c in d){var r=fr.client.FetchRatInfo(d[c]);s.push('<span class="rat-'+d[c]+'">'+(null!==r?r.CMDRname:"<i>Loading</i>")+"</span>")}var n=$('<tr id="rescue-'+a.id+'" onClick="javascript:fr.client.SetSelectedRescue('+a.id+')"><td>'+(void 0!==a.data.boardIndex?a.data.boardIndex:"X")+'</td><td title="'+(void 0!==a.data?"Nick: "+a.data.IRCNick:"")+'">'+a.client+' <span class="rescue-platform">'+("xb"!=a.platform?"PC":"Xbox")+"</span></td><td>"+(null!==a.system?a.system:"unknown")+"</td><td>"+s.join(", ")+"</td></tr>");a.epic?n.addClass("rescue-epic"):n.removeClass("rescue-epic"),a.codeRed?n.addClass("rescue-codered"):n.removeClass("rescue-codered"),a.active?n.removeClass("rescue-inactive"):n.addClass("rescue-inactive");var i=a.quotes.join("\n");debug&&console.log("AddRescue: Rescue Added to board."),fr.client.Rescues[a.id]=a,n.attr("title",i),t.append(n)},UpdateRescue:function(e){var t=$("#rescue-"+e.id),a=e,d=a.rats,s=[];for(var c in d){var r=fr.client.FetchRatInfo(d[c]);s.push('<span class="rat-'+d[c]+'">'+(null!==r?r.CMDRname:"<i>Loading</i>")+"</span>")}t.html("<td>"+(void 0!==a.data.boardIndex?a.data.boardIndex:"X")+'</td><td title="'+(void 0!==a.data?"IRC: "+a.data.IRCNick:"")+'">'+a.client+' <span class="rescue-platform">'+("xb"!=a.platform?"PC":"Xbox")+"</span></td><td>"+(null!==a.system?a.system:"unknown")+"</td><td>"+s.join(", ")+"</td>"),a.epic?t.addClass("rescue-epic"):t.removeClass("rescue-epic"),a.codeRed?t.addClass("rescue-codered"):t.removeClass("rescue-codered"),a.active?t.removeClass("rescue-inactive"):t.addClass("rescue-inactive");var n=a.quotes.join("\n");return t.attr("title",n),t.animate({opacity:.3},500).animate({opacity:1},500),a.open?(debug&&console.log("UpdateRescue - Rescue Updated: "+a.id+" : "+a.client),fr.client.Rescues[a.id]=a,void(e.id===fr.client.SelectedRescue.id&&(debug&&console.log("UpdateRescue - Rescue DetailView Updating: "+a.id+" : "+a.client),fr.client.SelectedRescue=a,fr.client.UpdateRescueDetail()))):(setTimeout(function(){t.hide("slow").remove()},5e3),debug&&console.log("UpdateRescue - Rescue Removed: "+a.id+" : "+a.client),void delete fr.client.Rescues[a.id])},GetRescueList:function(e){var t=$("#rescueTable");for(var a in e.data){var d=e.data[a];if(null!==d.data){var s=d.rats,c=[];for(var r in s){var n=fr.client.FetchRatInfo(s[r]);c.push('<span class="rat-'+s[r]+'">'+(null!==n?n.CMDRname:"<i>Loading</i>")+"</span>")}var i=$('<tr id="rescue-'+d.id+'" onClick="javascript:fr.client.SetSelectedRescue(\''+d.id+"')\"><td>"+(void 0!==d.data.boardIndex?d.data.boardIndex:"X")+'</td><td title="'+(void 0!==d.data?"Nick: "+d.data.IRCNick:"")+'">'+d.client+' <span class="rescue-platform">'+("xb"!=d.platform?"PC":"Xbox")+"</span></td><td>"+(null!==d.system?d.system:"unknown")+"</td><td>"+c.join(", ")+"</td></tr>");d.epic?i.addClass("rescue-epic"):i.removeClass("rescue-epic"),d.codeRed?i.addClass("rescue-codered"):i.removeClass("rescue-codered"),d.active?i.removeClass("rescue-inactive"):i.addClass("rescue-inactive");var l=d.quotes.join("\n");i.attr("title",l),fr.client.Rescues[d.id]=d,t.append(i)}}},UpdateClock:function(){var e=new Date;e.setUTCFullYear(e.getUTCFullYear()+1286);var t="";t+=e.getUTCFullYear(),t+="-"+(e.getUTCMonth()<10?"0":"")+e.getUTCMonth(),t+="-"+(e.getUTCDate()<10?"0":"")+e.getUTCDate(),t+=" "+(e.getUTCHours()<10?"0":"")+e.getUTCHours(),t+=":"+(e.getUTCMinutes()<10?"0":"")+e.getUTCMinutes(),t+=":"+(e.getUTCSeconds()<10?"0":"")+e.getUTCSeconds(),$(".ed-clock").text(t),setTimeout(fr.client.UpdateClock,500)},UpdateRescueClock:function(){if(null!==fr.client.SelectedRescue){var e=getTimeSpan(Date.now(),Date.parse(fr.client.SelectedRescue.createdAt)),t=Math.floor(e/3600)%24,a=Math.floor(e/60)%60,d=e%60,s="";s+=(t<10?"0":"")+t,s+=":"+(a<10?"0":"")+a,s+=":"+(d<10?"0":"")+d,$(".rdetail-time-sincecreate").text(s),setTimeout(fr.client.UpdateRescueClock,500)}},SetSelectedRescue:function(e){return null===e||null!==fr.client.SelectedRescue&&e===fr.client.SelectedRescue.id?(fr.client.SelectedRescue=null,void fr.client.UpdateRescueDetail()):null===fr.client.Rescues[e]?void console.log("SetSelectedRescue - invalid key: "+e):(debug&&console.log("SetSelectedRescue - New SelectedRescue: "+fr.client.Rescues[e].id),fr.client.SelectedRescue=fr.client.Rescues[e],void fr.client.UpdateRescueDetail())},UpdateRescueDetail:function(){if(!fr.client.SelectedRescue)return $("#rescueDetail").css("display","none"),$("#spacer").addClass("col-md-2").removeClass("col-md-0"),void $("#rescueBoard").addClass("col-md-8").removeClass("col-md-5");var e=fr.client.SelectedRescue,t='<div class="rdetail-header"><div class="rdetail-client">#'+e.data.boardIndex+" - "+(e.codeRed?'<font class="font-cred">CODE RED</font> - ':"")+(null!==e.title?e.title:e.client)+'</div><div class="rdetail-time-sincecreate">00:00:00</div></div><table class="table table-rescue"><tbody><tr id="RescueInfo-NickName"><td width="90px" ><strong>IRC Nick:</strong></td><td>'+e.data.IRCNick+'</td></tr><tr id="RescueInfo-System"><td><strong>System:</strong></td><td>'+e.system+"</td></tr><tr><td><strong>Platform:</strong></td><td>"+e.platform+"</td></tr><tr><td><strong>UUID:</strong></td><td>"+e.id+"</td></tr><tr><td></td><td></td></tr>",a=[];for(var d in e.rats){var s=fr.client.FetchRatInfo(e.rats[d]);a.push('<span class="rat-'+e.rats[d]+'">'+(null!==s?s.CMDRname:"<i>Loading</i>")+"</span>")}if(t+="<tr><td><strong>Rats:</strong></td><td>"+(a.length>0?a[0]:"")+"</td></tr>",a.length>1)for(var c=1;c<a;c++)t+="<tr><td></td><td>"+a[c]+"</td></tr>";if(t+="<tr><td></td><td></td></tr>",t+="<tr><td><strong>Quotes:</strong></td><td>"+(e.quotes.length>0?e.quotes[0]:"")+"</td></tr>",e.quotes.length>1)for(var c=1;c<e.quotes.length;c++)t+="<tr><td></td><td>"+e.quotes[c]+"</td></tr>";t+="<tr><td></td><td></td></tr></tbody></table>",debug&&console.log("UpdateRescueDetail - Rescue DetailView Updated: "+e.id+" : "+e.client),$("#rescueDetail").animate({opacity:.2},100).html(t).css("display","initial").animate({opacity:1},500),$("#spacer").addClass("col-md-0").removeClass("col-md-2"),$("#rescueBoard").addClass("col-md-5").removeClass("col-md-8"),fr.client.UpdateRescueClock()}};