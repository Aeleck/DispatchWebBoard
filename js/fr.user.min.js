var fr=void 0!==fr?fr:{},debug=void 0!==debug&&debug;fr.user=fr.config?{ApiData:null,Settings:null,AuthHeader:null,isAuthenticated:function(){return null!==fr.user.ApiData&&null!==fr.user.AuthHeader},hasPermission:function(){return!!fr.user.isAuthenticated&&("admin"===fr.user.ApiData.group||fr.user.ApiData.drilled)},init:function(){var e=GetCookie(fr.config.CookieBase+"token"),t=document.location.hash.match(/access_token=([\w-]+)/),o=!!t&&t[1];if(o)fr.user.AuthHeader=o,CanSetCookies()&&SetCookie(fr.config.CookieBase+"token",fr.user.AuthHeader,31536e6),history.replaceState&&history.replaceState({},document.title,window.location.pathname+window.location.search);else{if(!e)return void fr.user.DisplayLogin();fr.user.AuthHeader=e.replace("Bearer ",""),CanSetCookies()&&SetCookie(fr.config.CookieBase+"token",fr.user.AuthHeader,31536e6)}sessionStorage.getItem("user.ApiData")?(fr.user.ApiData=JSON.parse(sessionStorage.getItem("user.ApiData")),fr.user.handleLoginInit()):fr.user.getApiData(fr.user.AuthHeader,function(e){sessionStorage.setItem("user.ApiData",JSON.stringify(e)),fr.user.ApiData=e,fr.user.handleLoginInit()},function(){fr.user.handleApiDataFailure()})},logoutUser:function(){DelCookie(fr.config.CookieBase+"token"),window.location.reload()},handleLoginInit:function(){if(!fr.user.hasPermission())return void $("body").removeClass("loading").addClass("shutter-force user-nopermission");$("body").on("click","button.logout",function(e){fr.user.logoutUser()}),console.log("%cWelcome CMDR "+fr.user.ApiData.rats[0].CMDRname.toUpperCase()+". All is well here. Fly safe!","color: lightgreen; font-weight: bold; font-size: 1.25em;"),fr.ws.initConnection(),fr.client.init()},handleApiDataFailure:function(){debug&&console.log("Api retrieval failure - Displaying login"),fr.user.DisplayLogin()},DisplayLogin:function(){history.replaceState("",document.title,window.location.pathname),$("button.login").on("click",function(e){window.location.href=fr.config.ApiURI+"oauth2/authorize?response_type=token&client_id="+fr.config.ClientID+"&redirect_uri="+window.location}),$("body").removeClass("loading").addClass("shutter-force user-unauthenticated")},getApiData:function(e,t,o){$.ajax({url:fr.config.ApiURI+"profile",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e),t.setRequestHeader("Accept","application/json")},success:function(e){$("span.user");e&&e.data&&(debug&&console.log("fr.user.getApiData - Retrieved authenticated user information: ",e),t(e.data))},error:o})}}:null;